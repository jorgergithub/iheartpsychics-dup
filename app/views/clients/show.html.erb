<div class="row-fluid">
  <div class="span12">
    Welcome back, <%= @client.first_name %>
  </div>
</div>

<div class="row-fluid">
  <div class="span12">
    <h3>Account info</h3>
  </div>
</div>

<div class="row-fluid">
  <div class="span6">
    <table class="table">
      <tbody>
          <tr>
            <td>Minutes</td>
            <% if @client.minutes? %>
              <td><%= @client.minutes %></td>
            <% else %>
              <td>
                You have no minutes.
                <%= link_to "Add minutes now.", add_minutes_client_path %>
              </td>
            <% end %>
          </tr>
      </tbody>
    </table>

    <%= link_to "#{@client.pin? ? "Reset" : "Set"} my PIN", reset_pin_client_path, class: "btn btn-small" %>
    <%= link_to "Add minutes", add_minutes_client_path, class: "btn btn-small" %>
  </div>
</div>

<div class="row-fluid">
  <div class="span12">
    <h3>Phone numbers</h3>

    <% if @client.phones.any? %>
      <table class="table">
        <thead>
          <tr>
            <th></th>
            <th>Number</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <% @client.phones.each do |phone| %>
            <tr>
              <td>
                <%= link_to '<i class="icon-edit"></i>'.html_safe, edit_client_phone_path(phone) %>
                <%= link_to '<i class="icon-remove"></i>'.html_safe, phone, data: {confirm: "Are you sure?" }, :method => "delete" %>
              </td>
              <td><%= phone.formatted_number %></td>
              <td><%= phone.desc %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <div class="blank-state">
        No phones added yet.
      </div>
    <% end %>

    <%= link_to "Add new phone", new_client_client_phone_path, class: "btn btn-small" %>
  </div>
</div>

<div class="row-fluid">
  <div class="span12">
    <h3>My Psychics</h3>

    <table class="table">
      <thead>
        <tr>
          <th></th>
          <th>Psychic</th>
          <th>Extension</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @client.psychics.each do |psychic| %>
          <tr>
            <td>
              <% unless psychic == @client.favorite_psychic %>
                <%= link_to '<i class="icon-ok"></i>'.html_safe, make_favorite_client_path(psychic_id: psychic.id) %>
              <% end %>
            </td>
            <td><%= psychic.full_name %></td>
            <td><%= psychic.extension %></td>
            <td>
              <% if psychic == @client.favorite_psychic %>
                <span class="label label-success">Favorite</span>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <%= form_tag(search_psychic_path, method: "get") do %>
      <div class="input-append">
        <%= text_field_tag :q, "", placeholder: "Search psychics" %>
        <%= submit_tag "Go!", class: "btn" %>
      </div>
    <% end %>
  </div>
</div>

<div class="row-fluid">
  <div class="span12">
    <h3>Call History</h3>

    <% if @client.calls.any? %>
      <table class="table">
        <thead>
          <tr>
            <th>Date and time</th>
            <th>From</th>
            <th>Psychic</th>
            <th>Duration</th>
          </tr>
        </thead>
        <tbody>
          <% @client.calls.processed.reverse.each do |call| %>
            <tr>
              <td><%= call.parsed_start_time %></td>
              <td><%= call.formatted_number %></td>
              <td><%= call.psychic.full_name %></td>
              <td class="right">
                <%= call.formatted_duration %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <div class="blank-state">
        No calls logged yet.
      </div>
    <% end %>
  </div>
</div>
