<div class="row-fluid">
  <div class="span12">
    <h3>Account info</h3>
  </div>
</div>

<div class="row-fluid">
  <div class="span6">
    <table class="table table-hover">
      <tbody>
        <tr>
          <td>Your PIN</td>
          <td><%= @client.pin %></td>
        </tr>
        <tr>
          <td>Credits</td>
          <% if @client.balance? %>
            <td><%= @client.credits %></td>
          <% else %>
            <td>
              Your account is out of balance.
              <%= link_to "Add credits now.", new_order_path %>
            </td>
          <% end %>
        </tr>
      </tbody>
    </table>

    <%= link_to "#{@client.pin? ? "Reset" : "Set"} my PIN", reset_pin_client_path, class: "btn btn-small #{@client.pin? ? "" : "btn-danger"}" %>
    <%= link_to "Add credits", new_order_path, class: "btn btn-small" %>
  </div>
</div>

<div class="row-fluid">
  <div class="span12">
    <h3>Phone numbers</h3>

    <% if @phones.any? %>
      <table class="table table-hover">
        <thead>
          <tr>
            <th></th>
            <th>Number</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <% localized(@phones).each do |phone| %>
            <tr>
              <td class="admin-actions">
                <%= link_to '<i class="icon-edit"></i>'.html_safe, edit_client_phone_path(phone) %>
                <%= link_to '<i class="icon-remove"></i>'.html_safe, phone, data: {confirm: "Are you sure?" }, :method => "delete" %>
              </td>
              <td><%= phone.number %></td>
              <td><%= phone.desc %></td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <%= paginate @phones, :param_name => :page_phones %>

    <% else %>
      <div class="blank-state">
        No phones added yet.
        <%= link_to "Add one now.", new_client_client_phone_path %>
      </div>
    <% end %>

    <%= link_to "Add new phone", new_client_client_phone_path, class: "btn btn-small" %>
  </div>
</div>

<div class="row-fluid">
  <div class="span12">
    <h3>My Psychics</h3>

    <% if @psychics.any? %>
      <table class="table table-hover">
        <thead>
          <tr>
            <th></th>
            <th>Psychic</th>
            <th>Extension</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% @psychics.each do |psychic| %>
            <tr>
              <td class="admin-actions">
                <% if @client.favorite?(psychic) %>
                  <%= link_to '<i class="icon-heart favorited"></i>'.html_safe, remove_favorite_client_path(psychic_id: psychic.id) %>
                <% else %>
                  <%= link_to '<i class="icon-heart-empty favorite"></i>'.html_safe, make_favorite_client_path(psychic_id: psychic.id) %>
                <% end %>
              </td>
              <td><%= psychic.full_name %></td>
              <td><%= psychic.extension %></td>
              <td>
                <% if @client.favorite?(psychic) %>
                  <span class="label label-success">Favorite</span>
                <% else %>
                  <span class="label label-info">Recently Contacted</span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <%= paginate @psychics, :param_name => :page_psychics %>

    <% else %>
      <div class="blank-state">
        No psychics favorited yet.
        <%= link_to "Browse the complete list.", search_psychic_path %>
      </div>
    <% end %>

    <%= form_tag(search_psychic_path, method: "get") do %>
      <div class="input-append">
        <%= text_field_tag :q, "", placeholder: "Search psychics" %>
        <%= submit_tag "Go!", class: "btn" %>
      </div>
    <% end %>
  </div>
</div>

<div class="row-fluid">
  <div class="span12">
    <h3>Call History</h3>

    <% if @processed_calls.any? %>
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Call ID</th>
            <th>Date and time</th>
            <th>From</th>
            <th>Psychic</th>
            <th>Duration</th>
          </tr>
        </thead>
        <tbody>
          <% @processed_calls.reverse.each do |call| %>
            <tr>
              <td><%= call.id %></td>
              <td><%= call.parsed_start_time %></td>
              <td><%= call.formatted_number %></td>
              <td><%= call.psychic_name %></td>
              <td class="right">
                <%= call.formatted_duration %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <%= paginate @processed_calls, :param_name => :page_processed_calls %>

    <% else %>
      <div class="blank-state">
        No calls logged yet.
      </div>
    <% end %>
  </div>
</div>

<div class="row-fluid">
  <div class="span12">
    <h3>Credit Summary</h3>

    <% if @credits.any? %>
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Date and time</th>
            <th>Credits</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <% @credits.by_date.reverse.each do |credit| %>
            <tr>
              <td><%= credit.created_at %></td>
              <td><%= credit.credits %></td>
              <td>
                <% if credit.target %>
                  <% if credit.target.is_a?(Call) %>
                    <%= credit.description %>
                  <% else %>
                    <%= link_to credit.description, credit.target %>
                  <% end %>
                <% else %>
                  <%= credit.description %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <%= paginate @credits, :param_name => :page_credits %>

    <% else %>
      <div class="blank-state">
        No credit operations yet.
      </div>
    <% end %>
  </div>
</div>
