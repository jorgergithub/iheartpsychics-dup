<%= form_for([:admin, @client.user], :url => admin_client_path(@client), :html => { :class => 'form form-horizontal' }) do |f| %>

  <ul class="nav nav-tabs" id="tabs">
    <li class="active" data-toggle="tab"><%= link_to "Client", "#form" %></li>

    <% if f.object.persisted? %>
      <li data-toggle="tab"><%= link_to "Survey Responses (#{@client.call_surveys.count})", "#responses" %></li>
      <li data-toggle="tab"><%= link_to "Phones", "#phones" %></li>
    <% end %>
  </ul>

  <div class="tab-content">
    <div class="tab-pane active" id="form">
      <legend>Personal Info</legend>

      <%= render 'errors', object: @client.user, model_name: "client" %>

      <div class="control-group">
        <%= f.label :first_name, "Name", :class => 'control-label' %>
        <div class="controls">
          <%= f.text_field :first_name, placeholder: "First name", autofocus: true, autocomplete: 'on' %>
          <%= f.text_field :last_name, placeholder: "Last name" %>
        </div>
      </div>

      <div class="control-group">
        <%= f.label :username, :class => 'control-label' %>
        <div class="controls">
          <%= f.text_field :username %>
        </div>
      </div>

      <div class="control-group">
        <%= f.label :email, :class => 'control-label' %>
        <div class="controls">
          <%= f.email_field :email %>
        </div>
      </div>

      <%= f.fields_for :client do |cf| %>
        <div class="control-group">
          <%= cf.label :balance, "Balance", :class => 'control-label' %>
          <div class="controls">
            <%= cf.text_field :balance %>
          </div>
        </div>

        <%= f.fields_for :client do |cf| %>
          <%= add_checkbox cf, :receive_newsletters %>
        <% end %>
      <% end %>
    </div>

    <div class="tab-pane" id="phones">
      <div class="control-group">
        <%= f.fields_for :client do |cf| %>
          <%= cf.fields_for :phones, localized(@user.client.phones) do |builder| %>
            <%= render "phone_fields", :f => builder %>
          <% end %>

          <%= link_to_add_fields("Add a new phone number", cf, :phones, :class => "btn btn-small", :title => "Add a new phone number to this Client.") %>
        <% end %>
      </div>
    </div>

    <% if f.object.persisted? %>
      <div class="tab-pane" id="responses">
        <%= render "admin/surveys", target: @client %>
      </div>
    <% end %>
  </div>

  <%= f.submit "Save", class: "btn btn-primary" %>
  <%= link_to "Cancel", admin_clients_path, class: "btn" %>
<% end %>
